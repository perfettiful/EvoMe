<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>EvoMe</title>
	<link rel="stylesheet" type="text/css" href="css/style.css" media="screen" />
	<link href='http://fonts.googleapis.com/css?family=Roboto+Condensed' rel='stylesheet' type='text/css' />
</head>

  <body>
<div id="wrap">
	<div id="header">
		<div id="headerlinks">
		<a href="#" title="EvoMe">-EvoMe-</a>
		<a href="#" title="Gallery">-Gallery-    </a>
		<a title="About">About:</a>
		<a href="#" title="EC">|Evolutionary Computation| </a>
        <a href="https://rogeralsing.com/2008/12/07/genetic-programming-evolution-of-mona-lisa/" title="EvoLisa">|EvoLisa| </a>
        <a href="https://perfettiful.github.io" title="Contact">|Creator|</a>
		</div>
		<h1><a href="#">EvoMe - Genetic Image Reconstruction</a></h1>
	</div>

	<div id="sidebar"> <!--SideBar Section-->
		<h2>Evolutionary Progress:</h2>
		<div class="box">
            <div id="display"></div> <!--EvoMe Display Loop Location-->
        </div>
    </div>

	<div id="content"> <!--Paragraph Section-->
        <br>
        <br>
        <div id="container"> <!--Target img, Canvas & Controls Container-->
            <h1>Choose one of the sample images to evolve. . .</h1>
            <br>
            <table>
                <tr>
                    <td><img id="Lisa" src="img/evolisacap.JPG"></td>
                    <td><img id= "Pups" src="img/3pups.jpg"></td>
                    <td><img id="Tesselation" src="img/tesselation.png"></td>
                    <td><img id="Mondrian" src="img/Mondrian.jpg"></td>
                </tr>
                <tr>
                    <td><label><input type="radio" name="opt1" onclick="loadTargetImg(2);loadImgSrc(2)" value="<|>">Mona Lisa</label></td>
                    <td><label><input type="radio" name="opt2" onclick="loadTargetImg(3);loadImgSrc(3)" value="<|>">Puppies</label></td>
                    <td><label><input type="button" name="opt3" onclick="loadTargetImg(4);loadImgSrc(4)" value="<|>">Tessellation</label></td>
                    <td><label><input type="button" name="opt4" onclick="loadTargetImg(5);loadImgSrc(5)" value="<|>">Mondrian</label></td>

            </table>
            <!--Image input-->
            <br>
            <h1>Or, choose your own image (preferably 200px by 200px)</h1>
            <div>

                <input type="file" id="files" name="files[]" multiple onclick="loadTargetImg(1)" value = "<|>"><br>

                <input type="button" name="" onclick="loadImgSrc(1)" value="<|>">Click to Load Your Files<br>
            </div>
            <br>

            <h1>Loaded Img to be Targeted:</h1>
            <img id="evoInput">
            <br>
            <table id="controlButtons">
                <tr>
                <td><a href="javascript:void(0);" id="start">Start</a></td>
                <td><a href="javascript:void(0);" id="stop">Stop</a></td>
                <td><a href="javascript:void(0);" id="reset">Reset</a></td>
                </tr>
            </table>

            <!--Input img vs Evolving img panel-->
            <div id="inVsOut">
                <table>
                    <tr>
                        <td><h1>Target Image</h1></td>
                        <td><h1>Evolving Image</h1></td>
                    </tr>
                    <tr>
                        <td>

                        <div id="imagedest"></div>

                        </td>
                        <td>


                            <canvas id="c"></canvas><br>

                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="canvas__container" >
                                <canvas id="cnvs" class="canvas__canvas"></canvas>
                                <img src="" id="mirror" class="canvas__mirror" />
                            </div></td>
                        <td>
                            <a href="#" class="button" id="btn-download" download="EvoMeOutput.png">Download as PNG</a>
                        </td>
                    </tr>
                    </table>
            </div>
<script>

    function loadImgSrc(imgSrc) {
        switch (imgSrc) {
            case 1:
                document.getElementById("evoInput").src = document.getElementById("target").src;
                break;
            case 2:
                document.getElementById("evoInput").src = "img/evolisacap.JPG";
                break
            case 3:
                document.getElementById("evoInput").src = "img/3pups.jpg";
                break;
            case 4:
                document.getElementById("evoInput").src = "img/tesselation.png";
                break;
            case 5:
                document.getElementById("evoInput").src = "img/Mondrian.jpg";
                break;

        }
    }

        function selected(dis) {
            var ele = document.getElementById('set');
            if (dis.value == 'Missing') {
                ele.innerHTML = "MIssing something";
            }
            else {
                ele.innerHTML = "Correct";
            }
        }

        //check_value: fct
        function loadTargetImg(fieldvalue) {
            switch (fieldvalue) {
                case 1:
                    document.getElementById("imagedest").innerHTML = "<output id='list'>";
                    break;
                case 2:
                    document.getElementById("imagedest").innerHTML = "<img src='img/evolisacap.JPG'>";
                    break
                case 3:
                    document.getElementById("imagedest").innerHTML = "<img src='img/3pups.jpg'>";
                    break;
                case 4:
                    document.getElementById("imagedest").innerHTML = "<img src='img/tesselation.png'>";
                    break;
                case 5:
                    document.getElementById("imagedest").innerHTML = "<img src='img/Mondrian.jpg'>";
                    break;
            }
        }


    </script>
            <table>
                <tr>
                    <td>FITNESS:</td>
                    <td><span id="fitness">0</span></td>
                </tr>
                <tr>
                    <td>GENERATION:</td>
                    <td><span id="generation">0</span></td>
                </tr>
                <tr>
                    <td>POLYGONS:</td>
                    <td><span id="polygons">0</span></td>
                </tr>
            </table>
            <br/>
            <div>
                <p>Kernel Density Estimation</p>
                <!--Kernel Plot script, needs to be in position of display!
    <script>
        var faithfulData = [88,88,88,88,88,88,88,85,51,85,54,84,78,47,83,52,62,84,52,79,51,47,78,69,74,83,55,76,78,79,73,77,66,80,74,52,48,80,59,90,80,58,84,58,73,83,64,53,82,59,75,90,54,80,54,83,71,64,77,81,59,84,48,82,60,92,78,78,65,73,82,56,79,71,62,76,60,78,76,83,75,82,70,65,73,88,76,80,48,86,60,90,50,78,63,72,84,75,51,82,62,88,49,83,81,47,84,52,86,81,75,59,89,79,59,81,50,85,59,87,53,69,77,56,88,81,45,82,55,90,45,83,56,89,46,82,51,86,53,79,81,60,82,77,76,59,80,49,96,53,77,77,65,81,71,70,81,93,53,89,45,86,58,78,66,76,63,88,52,93,49,57,77,68,81,81,73,50,85,74,55,77,83,83,51,78,84,46,83,55,81,57,76,84,77,81,87,77,51,78,60,82,91,53,78,46,77,84,49,83,71,80,49,75,64,76,53,94,55,76,50,82,54,75,78,79,78,78,70,79,70,54,86,50,90,54,54,77,79,64,75,47,86,63,85,82,57,82,67,74,54,83,73,73,88,80,71,83,56,79,78,84,58,83,43,60,75,81,46,90,46,74];


        var margin = {top: 20, right: 30, bottom: 30, left: 40},
                width = 960 - margin.left - margin.right,
                height = 500 - margin.top - margin.bottom;

        var x = d3.scale.linear()
                .domain([0, 100])
                .range([0, width]);

        var y = d3.scale.linear()
                .domain([0, .1])
                .range([height, 0]);

        var xAxis = d3.svg.axis()
                .scale(x)
                .orient("bottom");

        var yAxis = d3.svg.axis()
                .scale(y)
                .orient("left")
                .tickFormat(d3.format("%"));

        var line = d3.svg.line()
                .x(function(d) { return x(d[0]); })
                .y(function(d) { return y(d[1]); });

        var histogram = d3.layout.histogram()
                .frequency(false)
                .bins(x.ticks(40));

        var svg = d3.select("body").append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        svg.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis)
                .append("text")
                .attr("class", "label")
                .attr("x", width)
                .attr("y", -6)
                .style("text-anchor", "end")
                .text("Precent RGB Error (%)");

        svg.append("g")
                .attr("class", "y axis")
                .call(yAxis);

        //d3.json("faithful.json", function(error, faithful) {
        //  if (error) throw error;

        var data = histogram(faithfulData),
                kde = kernelDensityEstimator(epanechnikovKernel(7), x.ticks(100));

        svg.selectAll(".bar")
                .data(data)
                .enter().insert("rect", ".axis")
                .attr("class", "bar")
                .attr("x", function(d) { return x(d.x) + 1; })
                .attr("y", function(d) { return y(d.y); })
                .attr("width", x(data[0].dx + data[0].x) - x(data[0].x) - 1)
                .attr("height", function(d) { return height - y(d.y); });

        svg.append("path")
                .datum(kde(faithfulData))
                .attr("class", "line")
                .attr("d", line);
        //});

        function kernelDensityEstimator(kernel, x) {
            return function(sample) {
                return x.map(function(x) {
                    return [x, d3.mean(sample, function(v) { return kernel(x - v); })];
                });
            };
        }

        function epanechnikovKernel(scale) {
            return function(u) {
                return Math.abs(u /= scale) <= 1 ? .75 * (1 - u * u) / scale : 0;
            };
        }
    </script>
    <!--
    <h2>Lorem Ipsum <span class="post-span">- by Maurice from 09 Feb 2013</span></h2>
    <img src="img/placeholder/technics-q-c-680-280-4.jpg" class="post-img" alt="Bild" />
    <p>Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</p>

    <h2>Lorem Ipsum <span class="post-span">- by Maurice from 09 Feb 2013</span></h2>
    <img src="img/placeholder/technics-q-c-680-280-1.jpg" class="post-img" alt="Bild" />
    <p>Duis autem vel eum iriure dolor in hendrerit in vulputate velit esse molestie consequat, vel illum dolore eu feugiat nulla facilisis at vero eros et accumsan et iusto odio dignissim qui blandit praesent luptatum zzril delenit augue duis dolore te feugait nulla facilisi. Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat.</p>

    <h2>Lorem Ipsum <span class="post-span">- by Maurice from 09 Feb 2013</span></h2>
    <img src="img/placeholder/technics-q-c-680-280-8.jpg" class="post-img" alt="Bild" />
    <p>Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper suscipit lobortis nisl ut aliquip ex ea commodo consequat. Duis autem vel eum iriure dolor in hendrerit in vulputate velit esse molestie consequat, vel illum dolore eu feugiat nulla facilisis at vero eros et accumsan et iusto odio dignissim qui blandit praesent luptatum zzril delenit augue duis dolore te feugait nulla facilisi.</p>
    -->
            </div>

            <div>
                <p>%Error & #Polygons vs. Generation #</p>
                <!--Kernel Plot script, needs to be in position of display!
    <script>
        var faithfulData = [88,88,88,88,88,88,88,85,51,85,54,84,78,47,83,52,62,84,52,79,51,47,78,69,74,83,55,76,78,79,73,77,66,80,74,52,48,80,59,90,80,58,84,58,73,83,64,53,82,59,75,90,54,80,54,83,71,64,77,81,59,84,48,82,60,92,78,78,65,73,82,56,79,71,62,76,60,78,76,83,75,82,70,65,73,88,76,80,48,86,60,90,50,78,63,72,84,75,51,82,62,88,49,83,81,47,84,52,86,81,75,59,89,79,59,81,50,85,59,87,53,69,77,56,88,81,45,82,55,90,45,83,56,89,46,82,51,86,53,79,81,60,82,77,76,59,80,49,96,53,77,77,65,81,71,70,81,93,53,89,45,86,58,78,66,76,63,88,52,93,49,57,77,68,81,81,73,50,85,74,55,77,83,83,51,78,84,46,83,55,81,57,76,84,77,81,87,77,51,78,60,82,91,53,78,46,77,84,49,83,71,80,49,75,64,76,53,94,55,76,50,82,54,75,78,79,78,78,70,79,70,54,86,50,90,54,54,77,79,64,75,47,86,63,85,82,57,82,67,74,54,83,73,73,88,80,71,83,56,79,78,84,58,83,43,60,75,81,46,90,46,74];


        var margin = {top: 20, right: 30, bottom: 30, left: 40},
                width = 960 - margin.left - margin.right,
                height = 500 - margin.top - margin.bottom;

        var x = d3.scale.linear()
                .domain([0, 100])
                .range([0, width]);

        var y = d3.scale.linear()
                .domain([0, .1])
                .range([height, 0]);

        var xAxis = d3.svg.axis()
                .scale(x)
                .orient("bottom");

        var yAxis = d3.svg.axis()
                .scale(y)
                .orient("left")
                .tickFormat(d3.format("%"));

        var line = d3.svg.line()
                .x(function(d) { return x(d[0]); })
                .y(function(d) { return y(d[1]); });

        var histogram = d3.layout.histogram()
                .frequency(false)
                .bins(x.ticks(40));

        var svg = d3.select("body").append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        svg.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis)
                .append("text")
                .attr("class", "label")
                .attr("x", width)
                .attr("y", -6)
                .style("text-anchor", "end")
                .text("Precent RGB Error (%)");

        svg.append("g")
                .attr("class", "y axis")
                .call(yAxis);

        //d3.json("faithful.json", function(error, faithful) {
        //  if (error) throw error;

        var data = histogram(faithfulData),
                kde = kernelDensityEstimator(epanechnikovKernel(7), x.ticks(100));

        svg.selectAll(".bar")
                .data(data)
                .enter().insert("rect", ".axis")
                .attr("class", "bar")
                .attr("x", function(d) { return x(d.x) + 1; })
                .attr("y", function(d) { return y(d.y); })
                .attr("width", x(data[0].dx + data[0].x) - x(data[0].x) - 1)
                .attr("height", function(d) { return height - y(d.y); });

        svg.append("path")
                .datum(kde(faithfulData))
                .attr("class", "line")
                .attr("d", line);
        //});

        function kernelDensityEstimator(kernel, x) {
            return function(sample) {
                return x.map(function(x) {
                    return [x, d3.mean(sample, function(v) { return kernel(x - v); })];
                });
            };
        }

        function epanechnikovKernel(scale) {
            return function(u) {
                return Math.abs(u /= scale) <= 1 ? .75 * (1 - u * u) / scale : 0;
            };
        }
    </script>
    <!--
    <h2>Lorem Ipsum <span class="post-span">- by Maurice from 09 Feb 2013</span></h2>
    <img src="img/placeholder/technics-q-c-680-280-4.jpg" class="post-img" alt="Bild" />
    <p>Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</p>

    <h2>Lorem Ipsum <span class="post-span">- by Maurice from 09 Feb 2013</span></h2>
    <img src="img/placeholder/technics-q-c-680-280-1.jpg" class="post-img" alt="Bild" />
    <p>Duis autem vel eum iriure dolor in hendrerit in vulputate velit esse molestie consequat, vel illum dolore eu feugiat nulla facilisis at vero eros et accumsan et iusto odio dignissim qui blandit praesent luptatum zzril delenit augue duis dolore te feugait nulla facilisi. Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat.</p>

    <h2>Lorem Ipsum <span class="post-span">- by Maurice from 09 Feb 2013</span></h2>
    <img src="img/placeholder/technics-q-c-680-280-8.jpg" class="post-img" alt="Bild" />
    <p>Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper suscipit lobortis nisl ut aliquip ex ea commodo consequat. Duis autem vel eum iriure dolor in hendrerit in vulputate velit esse molestie consequat, vel illum dolore eu feugiat nulla facilisis at vero eros et accumsan et iusto odio dignissim qui blandit praesent luptatum zzril delenit augue duis dolore te feugait nulla facilisi.</p>
    -->
            </div>

            <div id="controls">

                <!-- Evo metrics & control panel-->
                <div class="info"></div>
            </div>
        </div>
	</div>

	<div id="footer">
        Nathan Perfetti | 2016 <a target="_blank" href="http://perfettiful.github.io" title="Perfettiful's Github">Perfettiful</a>
        <div style="float: right;">
		<a href="#" title="Contact Us"><img src="img/contact.gif" alt="Contact" /></a>
		<a href="#" title="Sitemap"><img src="img/sitemap.gif" alt="Sitemap" /></a>
		<a href="#" title="Rss Feed"><img src="img/rss.png" alt="Rss Feed" /></a>
		</div>
	</div>
</div> <!--End Wrapper div-->

<!--Scripts-->
<script src="//d3js.org/d3.v3.min.js"></script> <!--D3 library-->

<!--Img URL export to JPG-->
<script>
    var c = document.getElementById('c'),
            ctx = c.getContext('2d'),
            mirror = document.getElementById('mirror');


    c.width = mirror.width = window.innerWidth;
    c.height = mirror.height = window.innerHeight;

    mirror.addEventListener('contextmenu', function (e) {
        var dataURL = canvas.toDataURL('image/png');
        mirror.src = dataURL;
    });

    var button = document.getElementById('btn-download');
    button.addEventListener('click', function (e) {
        var dataURL = canvas.toDataURL('image/png');
        button.href = dataURL;
    });

    //Test Canvs w/ simple Rectangle
    var canvas = document.getElementById("c");
    var ctx = canvas.getContext("2d");
    ctx.fillStyle = "#FF0000";
    ctx.fillRect(100, 100, 150, 75);

</script>

  <!--64 bit Data img URL converter-->
  <script>
      function handleFileSelect(evt) {
          var files = evt.target.files; // FileList object

          // Loop through the FileList and render image files as thumbnails.
          for (var i = 0, f; f = files[i]; i++) {

              // Only process image files.
              if (!f.type.match('image.*')) {
                  continue;
              }

              var reader = new FileReader();

              // Closure to capture the file information.
              reader.onload = (function(theFile) {
                  return function(e) {
                      // Render thumbnail.
                      var span = document.createElement('span');
                      span.innerHTML = ['<br><img id="target" alt="" src="', e.target.result,
                          '" title="', (theFile.name), '"/>'
                      ].join('');
                      document.getElementById('list').insertBefore(span, null);
                  };
              })(f);

              // Read in the image file as a data URL.
              reader.readAsDataURL(f);
          }
      }
      document.getElementById('files').addEventListener('change', handleFileSelect, false);
  </script>

  <!--EvoMe html canvas & controls script-->
  <script type="text/javascript">//Controls Script

  //Declaring var fitOutput, genOutput, polyOutput
  var fitOutput = document.getElementById('fitness'),
          genOutput = document.getElementById('generation'),
          polyOutput = document.getElementById('polygons');

  /*displayEvolution: fct takes an EvoLisa constructor (with target & output canvas)
    and a start time and output the gradual progress of evolution in the sidebar*/
  var displayEvolution = function(evo, startTime) {
      var div = document.createElement('div'),
              can = document.createElement('canvas'),
              display = document.getElementById('display');

      can.width = evoLisa.t.width;
      can.height = evoLisa.t.height;

      //Scales output img to 40% of size and adds running imgs to sidebar
      can.style.width = can.width * 2 / 5 + "px";
      can.style.height = can.height * 2 / 5 + "px";

      evo.draw(can);
      div.className = "container";

      //Vars to fill progress sidebar
      var gen = evoLisa.generation,
              poly = evoLisa.dna.dna.length,
              fit = evoLisa.dna.fit,
              timeTaken = new Date().getTime() - startTime;

      div.innerHTML = "<div class='info'>gen: " + gen + "<br/>fit: " + fit + "<br />poly: " + poly + "<br />t: " + timeTaken + "</div>";

      div.appendChild(can);
      display.appendChild(div);

     // collectData();
      console.log(gen, fit, poly);
  };

  /*Defining evo(), fct that takes the target and canvas elements,
  then defines evoLisa as the target and canvas ran through the EvoLisa constructor */
  var evo = function() {

      var tar = document.getElementById("evoInput"),
              canv = document.getElementById('c'),
              evoLisa = new EvoLisa(tar, canv);
      return evoLisa;
  }

  // Declaring evoLisa, start ,stop & reset
  var evoLisa,
          start = document.getElementById('start'),
          stop = document.getElementById('stop'),
          reset = document.getElementById('reset');

  //=========== Start runs go()=============
  start.onclick = function() {

     var dataCollect = true;

      if (typeof evoLisa === "undefined")
          evoLisa = evo();

      var startTime = new Date().getTime();

      evoLisa.start(function() {
          // update generation
          genOutput.innerHTML = evoLisa.generation;
          fitOutput.innerHTML = evoLisa.dna.fit;
          polyOutput.innerHTML = evoLisa.dna.dna.length;
          // shall we display another snapshot?
          if (evoLisa.generation % 500 == 0) {
              displayEvolution(evoLisa, startTime);
          }
      });
  };
  //======Stop stops evoLisa ====================================
  stop.onclick = function() {

      evoLisa.stop();
      dataCollect = false;

  };
  //=======Reset stops evoLisa, then runs evo()==================
  reset.onclick = function() {
      evoLisa.stop();
      evoLisa = evo();
      setTimeout(function() {
          start.click()
      }, 50);
      display.innerHTML = '';
  };
  //

//Script to export evo data from JS array to CSV-->
  var collectData = function() {

      var gen = evoLisa.generation,
              poly = evoLisa.dna.dna.length,
              fit = evoLisa.dna.fit;

      //Generate data array of arrays with first row as array of column headers


      evoDataHeaders = ["Generation", "Fitness", "Polygons"];
      evoData = [evoDataHeaders];

      //Push each new row to main array

      while (dataCollect = true) {
          evoData.push([gen, fit, poly]);
      }
  };
    //Export running data array to CSV
  var exportToCsv = function(filename, rows) {
      var processRow = function (row) {
          var finalVal = '';
          for (var j = 0; j < row.length; j++) {
              var innerValue = row[j] === null ? '' : row[j].toString();
              if (row[j] instanceof Date) {
                  innerValue = row[j].toLocaleString();
              }
              ;
              var result = innerValue.replace(/"/g, '""');
              if (result.search(/("|,|\n)/g) >= 0)
                  result = '"' + result + '"';
              if (j > 0)
                  finalVal += ',';
              finalVal += result;
          }
          return finalVal + '\n';
      };

      var csvFile = '';
      for (var i = 0; i < rows.length; i++) {
          csvFile += processRow(rows[i]);
      }

      var blob = new Blob([csvFile], {type: 'text/csv;charset=utf-8;'});
      if (navigator.msSaveBlob) { // IE 10+
          navigator.msSaveBlob(blob, filename);
      } else {
          var link = document.createElement("a");
          if (link.download !== undefined) { // feature detection
              // Browsers that support HTML5 download attribute
              var url = URL.createObjectURL(blob);
              link.setAttribute("href", url);
              link.setAttribute("download", filename);
              link.style.visibility = 'hidden';
              document.body.appendChild(link);
              link.click();
              document.body.removeChild(link);
          }
      }
  };
</script>

  <!--EvoMe main script-->
  <script src="js/index.js"></script>

</body>
